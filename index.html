<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Index</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":false,"default":{}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html"></a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="Coordinator">
            <span class="title">
                <a href="Coordinator.html">Coordinator</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Coordinator#db"><a href="Coordinator.html#db">db</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            <span class="subtitle">Typedefs</span>
            
                <li data-name="Coordinator~runTask"><a href="Coordinator.html#~runTask">runTask</a></li>
            
                <li data-name="Coordinator~taskDone"><a href="Coordinator.html#~taskDone">taskDone</a></li>
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Coordinator#schedule"><a href="Coordinator.html#schedule">schedule</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="Coordinator#event:possibleOverrun"><a href="Coordinator.html#event:possibleOverrun">possibleOverrun</a></li>
            
                <li data-name="Coordinator#event:timeout"><a href="Coordinator.html#event:timeout">timeout</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="Task">
            <span class="title">
                <a href="Task.html">Task</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Task#coordinator"><a href="Task.html#coordinator">coordinator</a></li>
            
                <li data-name="Task#fn"><a href="Task.html#fn">fn</a></li>
            
                <li data-name="Task#interval"><a href="Task.html#interval">interval</a></li>
            
                <li data-name="Task#name"><a href="Task.html#name">name</a></li>
            
                <li data-name="Task#running"><a href="Task.html#running">running</a></li>
            
                <li data-name="Task#timeout"><a href="Task.html#timeout">timeout</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Task#start"><a href="Task.html#start">start</a></li>
            
                <li data-name="Task#stop"><a href="Task.html#stop">stop</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="index.html">Index</h1>
        


    


    <h3> </h3>








    




    <section>
        <article class="readme"><h1>Task Coordinator</h1><p>Schedule a task to run at a fixed interval in at most one of your processes</p>
<p>They will coordinate which one runs each time using a mongodb collection</p>
<h2>Install</h2><p><code>npm install task-coordinator --save</code></p>
<h2>Usage</h2><pre class="prettyprint source lang-js"><code>// Create the coordinator using the given mongodb connection
// (mongoose in not necessary, this lib talks directly with the mongodb driver)
var coordinator = require('task-coordinator')(mongoose.db)

// Schedule a task to run every 5s
// Even if you deploy this to many machines/process, only one
// of them will execute the callback
var task = coordinator.schedule({
    name: 'task name',
    interval: 5e3
}, function (done) {
    // Do something, them call done()
})</code></pre><h2>How it works</h2><p>Each instance tries to insert a document in a collection in mongodb with a unique key in the task name. Only one call will succeed, that one will trigger the callback execution. When the task calls <code>done()</code>, that inserted document is removed.</p>
<h3>Synchronization</h3><p>A task scheduled to run every minute will run at 00:00:00Z, 00:01:00Z, 00:02:00Z and so on. That is, to ensure the execution interval, the tasks are run at whole intervals.</p>
<h3>Timeout</h3><p>If, for some reason, the task callback does not call <code>done()</code>, the locking mechanism would prevent the task from ever running again. To solve this problem, a lock may timeout after some time.</p>
<p>This approach also creates a problem: if the task is still running when the timeout expires, another task instance may start before the previous one completes. This would complete break the assumption of at most one task running.</p>
<p>You can set the desired behaviour with the <code>timeout</code> option and monitor violations listening to events <code>timeout</code>, <code>possibleOverrun</code>.</p>
<h2>Docs</h2><p>See generated docs on <a target="_blank" href="http://clubedaentrega.github.io/task-coordinator/docs">github</a></p></article>
    </section>






        

        <footer>
            Documentation generated by <a target="_blank" href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Tue Sep 08 2015 13:00:25 GMT-0300 (Hora oficial do Brasil)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>